---
title: "Getting started with NetCoupler"
author: 
    - "Clemens Wittenbecher"
    - "Luke Johnston"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting started with NetCoupler}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Brief description

The goal of NetCoupler is to estimate causal links between a set of -omic (e.g.
metabolomics, lipidomics) or other high-dimensional metabolic data and either a
disease outcome, an exposure, or both. The NetCoupler-algorithm, formulated by
Clemens Wittenbecher and converted into an R package by Luke Johnston, links
conditional dependency networks with an external outcome or exposure to identify
direct effects between them.

The NetCoupler's input is multi-layer information from prospective studies,
including interdependent variables that constitute the central network of
interest (e.g., metabolomics data), time-to-disease incidence, and optionally
information on factors that influence the network (such as lifestyle variables,
or genetic determinants).

TODO: Add figure demonstrating NetCoupler

Results can be graphically displayed as a joint network model. For example, to a
data-driven metabolomics network links can be added that reflect
network-independent associations of metabolites with disease risk and lifestyle
habits (or genetics) with these disease-related metabolites.


## Workflow

The general workflow for using NetCoupler is to:

1. Standardize variables that will form the network ("network variables") with
`nc_standardize()`.
1. Estimate the network linkages for the network variables with
`nc_create_network()`.
1. If interested in links to an *outcome*: Using the estimated network, extract
the network variables (both "index" and "neighbour" variable list) and identify
direct and ambiguous effects from the network to the outcome variable with
`nc_outcome_estimates()`.
1. If interested in links to an *exposure*: Just like with the *outcome*-side,
except identify direct and ambiguous effects from the exposure variable to the
network `nc_exposure_estimates()`.


1. Using the estimated network, extract the network variables (both "index" and
"neighbour" variable list) and identify direct and ambiguous effects with the
outcome variable with `nc_outcome_estimates()`. 
- Clusters of the variables will be selected based on the PC-algorithm
Select a subset of variables or clusters from the PC-alg
- Then run NetCoupler on that subset

## Directed acyclic graph skeleton estimation

The estimate the underlying directed acyclic graph (DAG) skeleton of the
metabolite network, NetCoupler uses an implementation of the PC-algorithm 
[@Kalisch2012;@Maathuis2010;@Spirtes2001;@Colombo2014]. Because of this, the
assumptions from the PC-algorithm apply to NetCoupler. The output of this
algorithm is a graphical model (`G`) of the underlying network that is used by
NetCoupler.

## Simple example of use

```{r example-use}
library(NetCoupler)
library(dplyr)

# Make partial independence network from metabolite data
metabolite_network <- simulated_data %>% 
    select(matches("metabolite")) %>% 
    nc_create_network()

outcome_estimates <- simulated_data %>%
    nc_outcome_estimates(
        .graph = metabolite_network,
        .outcome = "survival::Surv(survival_time, case_status)",
        .adjustment_vars = "Age",
        .model_function = survival::coxph
    )

outcome_estimates

exposure_estimates <- simulated_data %>%
    nc_exposure_estimates(
        .graph = metabolite_network,
        .exposure = "exposure",
        .adjustment_vars = "Age",
        .model_function = lm
    )

exposure_estimates
```
