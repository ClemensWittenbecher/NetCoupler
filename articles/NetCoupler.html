<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to NetCoupler • NetCoupler</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to NetCoupler">
<meta property="og:description" content="NetCoupler">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">NetCoupler</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/NetCoupler.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/NetCoupler/NetCoupler/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="NetCoupler_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to NetCoupler</h1>
                        <h4 class="author">Clemens Wittenbecher</h4>
                        <h4 class="author">Luke Johnston</h4>
            
            <h4 class="date">2020-09-15</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/NetCoupler/NetCoupler/blob/master/vignettes/NetCoupler.Rmd"><code>vignettes/NetCoupler.Rmd</code></a></small>
      <div class="hidden name"><code>NetCoupler.Rmd</code></div>

    </div>

    
    
<div id="goals" class="section level2">
<h2 class="hasAnchor">
<a href="#goals" class="anchor"></a>Goals</h2>
<ul>
<li>Work with pipe <code><a href="../reference/%&gt;%.html">%&gt;%</a></code> operator</li>
<li>Work with tidyselect helpers</li>
<li>Be autocomplete friendly (e.g. start function names with <code>nc_</code>)</li>
<li>In general, output as tibble, or at least easily modified into a data.frame/tibble</li>
<li>Arguments are prefixed with <code>.</code>
</li>
<li>Internal functions are prefixed with <code>.</code>?</li>
</ul>
</div>
<div id="brief-description" class="section level2">
<h2 class="hasAnchor">
<a href="#brief-description" class="anchor"></a>Brief description</h2>
<p>The <em>NetCoupler</em>-algorithm operates by taking the following steps:</p>
<ol style="list-style-type: decimal">
<li>The implementation of the PC-algorithm [1] in the pcalg package <span class="citation">[@Kalisch2012]</span> is applied to estimate the skeleton of the underlying directed acyclic graph (DAG) that generated the complex exposure data (e.g., metabolomics data).</li>
<li>For each network variable (e.g., metabolite), the adjacency set (all direct neighbors) is extracted from this undirected network. Assuming complete coverage of the measurements, the Markov parents of the network variable are necessarily a subset of its direct network neighbors. Adjustment for the Markov parents is sufficient to block all confounding influences by other network-variables (d-separation). Adjusting for descendants should be avoided because it can potentially introduce collider bias.</li>
<li>A multi-model procedure is applied. The relation of each network variable with time-to-the event of interest is adjusted for every possible subset of direct neighbors. Thereby, a confidence set of estimates is generated, which necessarily contains the valid direct effect estimate.</li>
<li>Network variables are classified based on the bounds of this confidence set of possible direct effects. As default, network variables are classified as directly affecting the outcome only if the confidence set of possible direct effects contains exclusively significant and consistent effect estimates.</li>
<li>The multi-model procedure is looped with adjusting all models for the previously identified direct effects (because these are potential confounders but cannot be colliders) until no further direct effects are identified.</li>
</ol>
<p>A similar procedure is provided to identify direct influences of external factors on network variables.</p>
</div>
<div id="workflow" class="section level2">
<h2 class="hasAnchor">
<a href="#workflow" class="anchor"></a>Workflow</h2>
<p>The general workflow for using NetCoupler is to:</p>
<ul>
<li>Take the metabolomics data and run the PC-alg on it</li>
<li>Select a subset of variables or clusters from the PC-alg</li>
<li>Then run NetCoupler on that subset</li>
</ul>
</div>
<div id="data-pre-processing" class="section level2">
<h2 class="hasAnchor">
<a href="#data-pre-processing" class="anchor"></a>Data pre-processing</h2>
<p>Metabolic variables should be log-transformed and standardized on potential confounders {{this the best way?}} by regressing on age, sex, BMI, and prevalence of hypertension and using the residual variance in further models. Metabolites were then scaled (mean of zero and standard deviation of one). {{both regressed and scaled?}}</p>
</div>
<div id="directed-acyclic-graph-skeleton-estimation" class="section level2">
<h2 class="hasAnchor">
<a href="#directed-acyclic-graph-skeleton-estimation" class="anchor"></a>Directed acyclic graph skeleton estimation</h2>
<p>The estimate the underlying directed acyclic graph (DAG) skeleton of the metabolite network, NetCoupler uses an implementation of the PC-algorithm <span class="citation">[@Kalisch2012;@Maathuis2010;@Spirtes2001;@Colombo2014]</span>. Because of this, the assumptions from the PC-algorithm apply to NetCoupler. The output of this algorithm is a graphical model (<code>G</code>) of the underlying network that is used by NetCoupler.</p>
</div>
<div id="confidence-ranges-based-on-multi-model-procedures" class="section level2">
<h2 class="hasAnchor">
<a href="#confidence-ranges-based-on-multi-model-procedures" class="anchor"></a>Confidence ranges based on multi-model procedures</h2>
<p>The estimated DAG skeleton … {{complete later. Not clear about this right now. (page 43 of thesis)}}</p>
</div>
<div id="explanation-of-netcoupler" class="section level2">
<h2 class="hasAnchor">
<a href="#explanation-of-netcoupler" class="anchor"></a>Explanation of NetCoupler</h2>
<p>Given that 1) an exposure can potentially affect metabolite concentrations (<code>exposure -&gt; metabolomics network</code>) and that 2) metabolites can potentially affect the development of a disease (<code>metabolomic network -&gt; outcome</code>), two initial algorithms are needed: One for the exposure side (<code>nc_exposure_network</code>) and one for the disease/outcome (<code>nc_outcome_network</code>) side. The explanation and description of NetCoupler are taken heavily from Clemens Wittenbecher’s PhD thesis <span class="citation">[@Wittenbecher2017]</span>.</p>
<div id="exposure-side-network-effect-estimation" class="section level3">
<h3 class="hasAnchor">
<a href="#exposure-side-network-effect-estimation" class="anchor"></a>Exposure-side network effect estimation</h3>
<p>The exposure-side network retrieves a range of potential direct effects of exogenous {{word?}} factors on the metabolite network. The general algorithm for the exposure-side estimation is:</p>
<pre><code>input: DAG-skeleton (G)
observations on: network variables (M), exogenous exposures (X), confounders (C)

begin with empty direct effect (DE)
repeat until no further ith M (Mi) is classified as DE
    add new DE to DE
    begin where AMB = M
    repeat until all Mi that are elements of AMB have been selected
        select a variable Mi from AMB
        select all nodes adjacent to Mi in G, adj(G, Mi)
        repeat until no further non-redundant subset (S) can be selected from adj(G, Mi)
            select a S that is an element of adj(G, Mi)
            estimate the predicted Mi as a function of (~) {{confirm}} X
                conditional on S, DE, and C
            add effect estimate PR for X on Mi to the ith confidence set (CS) {{confirm}}
        end
        if the lower bound of CSi &gt; 0 or the upper bound CSi &lt; 0 and
                sign(pe1) = sign(pe2) {{meaning?}} for every pair of estimates in CSi
            classify Mi as affected by X
        else if the lower bound of CSi &gt; 0 or the upper bound of CSi &lt; 0 and 
                0 is an element of CSi or 
                the sign(pe1) is not = sign(pe2) for every pair of estimates in CSi
            classify Mi as ambiguous with respect to X
        else 
            classify Mi as non-affected by X
    end
end

output: CS for effects of X on M based on G
            
classification of every Mi that is an element of M as 
    affected (X -&gt; Mi)
    non-affected (X  Mi)
    ambiguous (X -- Mi)</code></pre>
<p>Where <code>AMB</code> is {{meaning?}}, <code>PE</code> is {{meaning?}}, <code>adj(G, Mi)</code> is the set of nodes adjust to <code>Mi</code> in <code>G</code> that are congruent (<span class="math inline">\(\equiv\)</span>) to direct neighbors of <code>Mi</code> in <code>G</code>.</p>
<p>This assumes full source population information. For applications to a sample of the population, the following decision rules were applied:</p>
<ol style="list-style-type: decimal">
<li>Consider the exposure-metabolite pair only if associated at a false discovery rate (FDR) controlled p-value &lt;0.01 based on a model <em>not adjusted</em> for the adjacent metabolites (<code>S</code> is empty {{correct?}}, the marginal model).</li>
<li>Consider the effect estimates as zero (0) if the p-value is &gt;0.05.</li>
</ol>
<p>For a given exposure, a metabolite would be classified as non-affected if the FDR-adjusted p-value was non-significant in the marginal model. If there was a significant FDR-controlled p-value in the marginal model and all estimates in the confidence set (<code>CS</code> {{? correct?}}) were significant and consistent, then the metabolite would be classified as affected by the exposure. Other metabolites would be classified as ambiguous with respect to the exposure.</p>
<p>{{TODO: reduce reliance on p-values or use another metric? Or do some bootstrapping/CV?}}</p>
<p>The outer loop includes identifying directly affected metabolites into the fixed model part. Then the procedure was repeated on the still ambiguous metabolites to check whether further unambiguous classification was possible based on the additional information. In the applied version of NetCoupler, this was limited to metabolites in the same connected components, which are defined as a group of two or more directly linked metabolites that were all associated with the exposure in the marginal model.</p>
<p>The rationale was that indirect effects could only be mediated by metabolites that were themselves (directly or indirectly) affected by the exposure. These metabolites were expected to be marginally associated with the exposure. In theory, there could be possible scenarios where the incidental cancellation of several direct and indirect effects concealed exposure-dependency in the marginal model <span class="citation">[@Pearl2009]</span></p>
<p>Still, high abundance of incidental cancellations are considered unlikely based on observed correlation structures and the chance to unambiguously resolve such complicated scenarios in the applied modelling approach is low {{proof of claim?}}. Therefore, the pragmatic decision was taken to adjust remaining ambiguous metabolites only for directly affected metabolites identified within the same connected component.</p>
<p>{{TODO: rearrange this}}</p>
<p>Network adjustments were used to resolve indirect effects mediated by another network variable (e.g. <code>exposure -&gt; mediating metabolite -&gt; metabolite</code>).</p>
</div>
<div id="outcome-side-network-effect-estimation" class="section level3">
<h3 class="hasAnchor">
<a href="#outcome-side-network-effect-estimation" class="anchor"></a>Outcome-side network effect estimation</h3>
<p>The outcome-side network retrieves direct effects of network variables on later occurring events.</p>
<p>There are similarities to the exposure-side algorithm for the outcome-side algorithm, except that the directionality is reversed (<code>metabolite -&gt; outcome</code>). This change in directionality also has implications on the decision rules. There may also be potential network-variable confounders and introduction of spurious associations (<code>metabolite &lt;- confounding metabolite -&gt; outcome</code>). The general algorithm for the outcome-side estimation is:</p>
<pre><code>input: DAG-skeleton G (Graphical model)
observations on: network variables (M), outcome (O), confounders (C)

begin with empty direct effect (DE)
repeat until no further ith M (Mi) is classified as DE
    add new DE to DE
    begin where AMB = M
    repeat until all Mi have been selected
        select a variable Mi from M {{not AMB?}}
        select all nodes adjacent to Mi in G, adj(G, Mi)
        repeat until no further non-redundant subset (S) can be selected from adj(G, Mi)
            select a S from adj(G, Mi)
            estimate outcome as a function of Mi conditional on S, C
            add effect estimate PE for Mi on O to confidence set (CSi)
        end
        if the lower bound of CSi &gt; 0 or upper bound of CSi &lt; 0 and
                sign(pe1) = sign(pe2) for every pair of estimates in CSi
            classify Mi as affecting risk of O
        else if lower bound of CSi &gt; 0 or upper bound of CSi &lt; 0 and
                0 is in CSi or 
                sign(pe1) = sign(pe2) for any pair of estimates in CSi
            classify Mi as ambiguous with respect to risk of O
        else
            classify Mi as non-affecting risk to O
    end
end

output: CS for effects of M on O based on G

classification of every Mi from M as 
    effector on O (Mi -&gt; O)
    non-effector on O (Mi  O)
    ambiguous (Mi -- O)</code></pre>
<p>Where <code>AMB</code> is {{meaning?}}, <code>PE</code> is {{meaning?}}, <code>adj(G, Mi)</code> is the set of nodes adjust to <code>Mi</code> in <code>G</code> that are congruent (<span class="math inline">\(\equiv\)</span>) to direct neighbors of <code>Mi</code> in <code>G</code>.</p>
<p>An indirect effect, unlike confounding, is not biased. Decision rules were adjusted to avoid bias:</p>
<ol style="list-style-type: decimal">
<li>Consider a metabolite-outcome pair only if significantly associated at a FDR-adjusted p-value &lt;0.1 based on a model adjusted for all adjacent metabolites (<code>S = adj(Mi)</code>)</li>
<li>Consider effect estimates as 0 if p-value is &gt;0.05</li>
</ol>
<p>Metabolites are classified as affecting the outcome if the FDR-adjusted p-value was significant in the model adjusted for the full adjacency set and all estimates in the confidence set are significant and consistent. Metabolites are considered not directly affecting the outcome if they were not significantly associated in the model adjusted for the full adjacency set. All others were considered ambiguous.</p>
</div>
<div id="step-wise-iteration-for-full-network-estimation" class="section level3">
<h3 class="hasAnchor">
<a href="#step-wise-iteration-for-full-network-estimation" class="anchor"></a>Step-wise iteration for full network estimation</h3>
<ol style="list-style-type: decimal">
<li>The DAG skeleton of the metabolite network is estimated</li>
<li>Initial, tentative links are formed with the exposure-side of the network.</li>
<li>Direct effects are estimated between exposure and network.</li>
<li>Repeat identification of links, classifying as unaffected or ambiguous and deleting indirect links.</li>
<li>Initial, tentative links are formed with the outcome-side of the network.</li>
<li>Direct effects are estimated between the network and the outcome.</li>
<li>Repeat link identification, deleting indirect links and classifying others as unaffected or ambiguous.</li>
<li>Combine the exposure-side and outcome-side network estimates into a joint graphical model.</li>
</ol>
<!-- TODO: Put this into a bib file. --><ol style="list-style-type: decimal">
<li><em>Spirtes P, Glymour C. An Algorithm for Fast Recovery of Sparse Causal Graphs. Social Science Computer Review 1991;9:62-72.</em></li>
</ol>
<!-- thesis https://publishup.uni-potsdam.de/frontdoor/index/index/searchtype/collection/id/17105/start/1/rows/10/facetNumber_author_facet/all/doctypefq/doctoralthesis/docId/40459 --><p>2 <em>Markus Kalisch, Martin Maechler, Diego Colombo, Marloes H. Maathuis, Peter Buehlmann (2012). Causal Inference Using Graphical Models with the R Package pcalg. Journal of Statistical Software, 47(11), 1-26. URL <a href="http://www.jstatsoft.org/v47/i11/" class="uri">http://www.jstatsoft.org/v47/i11/</a>.</em></p>
</div>
</div>
<div id="simple-example-of-use" class="section level2">
<h2 class="hasAnchor">
<a href="#simple-example-of-use" class="anchor"></a>Simple example of use</h2>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/NetCoupler/NetCoupler">NetCoupler</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org">dplyr</a></span>)
</pre></div>
<div id="estimating-the-metabolic-network" class="section level3">
<h3 class="hasAnchor">
<a href="#estimating-the-metabolic-network" class="anchor"></a>Estimating the metabolic network</h3>
<p>For estimating the network, it’s (basically) required to standardize the metabolic variables before inputting into <code><a href="../reference/nc_estimate_network.html">nc_estimate_network()</a></code>. This function also log-transforms and scales (mean-center and z-score normalize) the values of the metabolic variables. We do this because the network estimation algorithm can sometimes be finicky about differences in variable numerical scale (mean of 1 vs mean of 1000).</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="kw">std_metabolic_data</span> <span class="op">&lt;-</span> <span class="kw">simulated_data</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="../reference/nc_standardize.html">nc_standardize</a></span>(<span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span>(<span class="st">"metabolite"</span>))
</pre></div>
<p>If you intend to also adjust for potential confounders when estimating the exposure or outcome side connections, you can include the potential impact these confounders may have on the network by regressing the confounders on the metabolic variables. Then the residuals can be extracted and used when constructing the network. You do this also with the <code><a href="../reference/nc_standardize.html">nc_standardize()</a></code> function.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw">std_metabolic_data</span> <span class="op">&lt;-</span> <span class="kw">simulated_data</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="../reference/nc_standardize.html">nc_standardize</a></span>(<span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span>(<span class="st">"metabolite"</span>),
                   .regressed_on = <span class="st">"age"</span>)
</pre></div>
<p>After that, you can estimate the network.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="co"># Make partial independence network from metabolite data</span>
<span class="kw">metabolite_network</span> <span class="op">&lt;-</span> <span class="kw">std_metabolic_data</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="../reference/nc_estimate_network.html">nc_estimate_network</a></span>(<span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span>(<span class="st">"metabolite"</span>))
</pre></div>
<p>To see what the network looks like, use the function <code><a href="../reference/nc_plot_network.html">nc_plot_network()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="kw">std_metabolic_data</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/nc_plot_network.html">nc_plot_network</a></span>(<span class="kw">metabolite_network</span>)
</pre></div>
<p><img src="NetCoupler_files/figure-html/visualize-metabolic-network-1.png" width="537.6"></p>
<p>The plot is a bit crowded, but it provides a base to start tidying up from.</p>
</div>
<div id="estimating-exposure-and-outcome-side-connections" class="section level3">
<h3 class="hasAnchor">
<a href="#estimating-exposure-and-outcome-side-connections" class="anchor"></a>Estimating exposure and outcome-side connections</h3>
<p>For the exposure and outcome side, you should standardize the metabolic variables, but this time, we don’t regress on the confounders since they will be included in the models.</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="kw">standardized_data</span> <span class="op">&lt;-</span> <span class="kw">simulated_data</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="../reference/nc_standardize.html">nc_standardize</a></span>(<span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span>(<span class="st">"metabolite"</span>))
</pre></div>
<p>Now you can estimate the outcome or exposure and identify direct effects for either the exposure side (<code>exposure -&gt; metabolite</code>) or the outcome side (<code>metabolite -&gt; outcome</code>). For more detail on the algorithm, see the <code>vignette("description")</code>. For the exposure side, the function identifies whether a link between the exposure and an index node (one metabolic variable in the network) exists, regardless of conditioning on potential confounders and on neighbouring nodes (other metabolic variables linked to the index variable). Depending on how consistent and strong the link is, the effect is classified as “direct”, “ambiguous”, or “none”.</p>
<p>In the example below, we specifically generated the simulated data so that the exposure associated with the metabolites 1, 8, and 12. And as we can see, those links have been correctly identified.</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="kw">outcome_estimates</span> <span class="op">&lt;-</span> <span class="kw">standardized_data</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/nc_model_estimates.html">nc_outcome_estimates</a></span>(
        .edge_tbl = <span class="fu"><a href="../reference/as_edge_tbl.html">as_edge_tbl</a></span>(<span class="kw">metabolite_network</span>),
        .outcome = <span class="st">"outcome_continuous"</span>,
        .model_function = <span class="kw">lm</span>
    )
<span class="kw">outcome_estimates</span>
<span class="co">#&gt; # A tibble: 11 x 9</span>
<span class="co">#&gt;    outcome index_node estimate std_error p_value conf_low conf_high adj_p_value</span>
<span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt;  1 outcom… metabolit… -0.00437    0.0223  0.845  -0.0481    0.0393       0.888 </span>
<span class="co">#&gt;  2 outcom… metabolit… -0.129      0.0221  0      -0.173    -0.0861       0     </span>
<span class="co">#&gt;  3 outcom… metabolit…  0.260      0.0215  0       0.218     0.302        0     </span>
<span class="co">#&gt;  4 outcom… metabolit… -0.0350     0.0223  0.116  -0.0787    0.00865      0.180 </span>
<span class="co">#&gt;  5 outcom… metabolit…  0.171      0.0220  0       0.128     0.214        0     </span>
<span class="co">#&gt;  6 outcom… metabolit…  0.0491     0.0223  0.0275  0.00545   0.0928       0.0487</span>
<span class="co">#&gt;  7 outcom… metabolit…  0.120      0.0221  0       0.0764    0.163        0     </span>
<span class="co">#&gt;  8 outcom… metabolit… -0.0381     0.0223  0.0875 -0.0818    0.00560      0.143 </span>
<span class="co">#&gt;  9 outcom… metabolit…  0.0149     0.0223  0.503  -0.0288    0.0586       0.589 </span>
<span class="co">#&gt; 10 outcom… metabolit…  0.0338     0.0223  0.130  -0.00993   0.0775       0.196 </span>
<span class="co">#&gt; 11 outcom… metabolit…  0.189      0.0219  0       0.147     0.232        0     </span>
<span class="co">#&gt; # … with 1 more variable: effect &lt;chr&gt;</span>

<span class="kw">exposure_estimates</span> <span class="op">&lt;-</span> <span class="kw">standardized_data</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/nc_model_estimates.html">nc_exposure_estimates</a></span>(
        .edge_tbl = <span class="fu"><a href="../reference/as_edge_tbl.html">as_edge_tbl</a></span>(<span class="kw">metabolite_network</span>),
        .exposure = <span class="st">"exposure"</span>,
        .model_function = <span class="kw">lm</span>
    )

<span class="kw">exposure_estimates</span>
<span class="co">#&gt; # A tibble: 11 x 9</span>
<span class="co">#&gt;    exposure index_node estimate std_error p_value conf_low conf_high adj_p_value</span>
<span class="co">#&gt;    &lt;chr&gt;    &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt;  1 exposure metabolit…  0.151      0.0215 0.        0.109     0.193     0       </span>
<span class="co">#&gt;  2 exposure metabolit… -0.362      0.0202 0.       -0.402    -0.322     0       </span>
<span class="co">#&gt;  3 exposure metabolit… -0.0171     0.0218 4.32e-1  -0.0598    0.0256    0.523   </span>
<span class="co">#&gt;  4 exposure metabolit…  0.0189     0.0218 3.87e-1  -0.0239    0.0616    0.516   </span>
<span class="co">#&gt;  5 exposure metabolit…  0.0279     0.0218 2.00e-1  -0.0148    0.0706    0.364   </span>
<span class="co">#&gt;  6 exposure metabolit…  0.0207     0.0218 3.42e-1  -0.0220    0.0634    0.503   </span>
<span class="co">#&gt;  7 exposure metabolit… -0.0230     0.0218 2.90e-1  -0.0658    0.0197    0.473   </span>
<span class="co">#&gt;  8 exposure metabolit…  0.00157    0.0218 9.43e-1  -0.0412    0.0443    0.943   </span>
<span class="co">#&gt;  9 exposure metabolit…  0.0198     0.0218 3.62e-1  -0.0229    0.0626    0.503   </span>
<span class="co">#&gt; 10 exposure metabolit… -0.328      0.0205 0.       -0.368    -0.288     0       </span>
<span class="co">#&gt; 11 exposure metabolit… -0.0780     0.0217 3.36e-4  -0.121    -0.0354    0.000868</span>
<span class="co">#&gt; # … with 1 more variable: effect &lt;chr&gt;</span>
</pre></div>
<p>If you want to adjust for confounders and having already used <code>.regressed_on</code> in the <code><a href="../reference/nc_standardize.html">nc_standardize()</a></code> function, add confounders to <code><a href="../reference/nc_model_estimates.html">nc_outcome_estimates()</a></code> or <code><a href="../reference/nc_model_estimates.html">nc_exposure_estimates()</a></code> with the <code>.adjustment_vars</code> argument:</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="kw">outcome_estimates</span> <span class="op">&lt;-</span> <span class="kw">standardized_data</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/nc_model_estimates.html">nc_outcome_estimates</a></span>(
        .edge_tbl = <span class="fu"><a href="../reference/as_edge_tbl.html">as_edge_tbl</a></span>(<span class="kw">metabolite_network</span>),
        .outcome = <span class="st">"outcome_continuous"</span>,
        .model_function = <span class="kw">lm</span>,
        .adjustment_vars = <span class="st">"age"</span>
    )
</pre></div>
</div>
<div id="plotting" class="section level3">
<h3 class="hasAnchor">
<a href="#plotting" class="anchor"></a>Plotting</h3>
<p>To visualize the results of the linked network graph and the effect classification, there are two functions to show the exposure and the outcome plots. In general, these plot functions are currently mostly for exploratory purposes and are too “busy” and crowded to be meaningful for presentation or publication. However, these are good starting points for making prettier, more legible plots.</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="fu"><a href="../reference/nc_plot_outcome_estimation.html">nc_plot_outcome_estimation</a></span>(
    <span class="kw">standardized_data</span>,
    <span class="kw">metabolite_network</span>,
    <span class="kw">outcome_estimates</span>
)
</pre></div>
<p><img src="NetCoupler_files/figure-html/plot-outcome-estimation-networks-1.png" width="672"></p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="fu"><a href="../reference/nc_plot_outcome_estimation.html">nc_plot_exposure_estimation</a></span>(
    <span class="kw">standardized_data</span>,
    <span class="kw">metabolite_network</span>,
    <span class="kw">exposure_estimates</span>
)
</pre></div>
<p><img src="NetCoupler_files/figure-html/plot-exposure-estimation-networks-1.png" width="672"></p>
</div>
</div>
<div id="slow-code-use-parallel-processing-with-future" class="section level2">
<h2 class="hasAnchor">
<a href="#slow-code-use-parallel-processing-with-future" class="anchor"></a>Slow code? Use parallel processing with future</h2>
<p>If the analysis is taking a while, you can use the future package to speed things up by implementing parallel processing. Set the <code>.parallel</code> argument to <code>TRUE</code> in either <code><a href="../reference/nc_model_estimates.html">nc_outcome_estimates()</a></code> or <code><a href="../reference/nc_model_estimates.html">nc_exposure_estimates()</a></code> and then use the future package with a given <code><a href="https://rdrr.io/pkg/future/man/plan.html">plan()</a></code>. If you use RStudio, the only usable strategy is <code>multisession</code>. After you run your code, close up the parallel processing by putting it back to normal with <code><a href="https://rdrr.io/pkg/future/man/plan.html">plan(sequential)</a></code>. Using the future package you can speed up the processing by almost 2.5 times.</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/HenrikBengtsson/future">future</a></span>)
<span class="fu"><a href="https://rdrr.io/pkg/future/man/plan.html">plan</a></span>(<span class="kw">multisession</span>)
<span class="kw">outcome_estimates</span> <span class="op">&lt;-</span> <span class="kw">standardized_data</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/nc_model_estimates.html">nc_outcome_estimates</a></span>(
        .edge_tbl = <span class="fu"><a href="../reference/as_edge_tbl.html">as_edge_tbl</a></span>(<span class="kw">metabolite_network</span>),
        .outcome = <span class="st">"outcome_continuous"</span>,
        .model_function = <span class="kw">lm</span>,
        .parallel = <span class="fl">TRUE</span>
    )
<span class="fu"><a href="https://rdrr.io/pkg/future/man/plan.html">plan</a></span>(<span class="kw">sequential</span>)
</pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Luke Johnston, Clemens Wittenbecher.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
